<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Typing Speed Test</title>
<style>
  :root{
    --bg:#0f1724; --card:#0b1220; --accent:#06b6d4; --muted:#94a3b8; --success:#10b981; --danger:#ef4444;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background:linear-gradient(180deg,#071027 0%, #0b1220 100%);
    color:#e6eef8; min-height:100vh; display:flex; align-items:center; justify-content:center; padding:24px;
  }
  .card{
    width:100%; max-width:980px; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:12px; padding:20px; box-shadow: 0 10px 30px rgba(2,6,23,0.7); border:1px solid rgba(255,255,255,0.04);
  }
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:16px}
  header h1{font-size:1.15rem;margin:0}
  header p{margin:0;color:var(--muted);font-size:0.92rem}

  .controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  select,input[type=number]{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
  button{padding:8px 12px;border-radius:8px;border:0;background:var(--accent);color:#052027;cursor:pointer;font-weight:600}
  button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
  button:disabled{opacity:0.5;cursor:not-allowed}

  .meta{display:flex;gap:12px;margin-top:12px;flex-wrap:wrap}
  .stat{background:rgba(255,255,255,0.02);padding:12px;border-radius:10px;min-width:120px;text-align:center}
  .stat .num{font-size:1.25rem;font-weight:700}
  .stat .lbl{color:var(--muted);font-size:0.85rem}

  .paragraph{
    margin-top:18px;padding:16px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
    line-height:1.7;border:1px solid rgba(255,255,255,0.03); font-size:1.05rem;
  }
  .paragraph .char{padding:0 1px;white-space:pre-wrap}
  .char.correct{color:var(--success)}
  .char.wrong{color:var(--danger); text-decoration:underline wavy rgba(239,68,68,0.6) 1px}
  .char.current{background:rgba(6,182,212,0.06);border-radius:3px;color:var(--accent)}

  .type-area{margin-top:14px; display:flex; gap:12px; align-items:flex-start; flex-wrap:wrap}
  textarea#input{flex:1;min-height:120px;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;resize:vertical}
  .right-panel{width:220px;min-width:180px}
  .timer{font-size:2rem;font-weight:700;color:var(--accent);text-align:center;margin-bottom:8px}
  .progress{height:8px;background:rgba(255,255,255,0.03);border-radius:999px;overflow:hidden}
  .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#7c3aed);width:0%}

  .footer{display:flex;justify-content:space-between;align-items:center;margin-top:16px;flex-wrap:wrap;color:var(--muted);font-size:0.9rem}
  .small{font-size:0.85rem;color:var(--muted)}

  /* responsive */
  @media (max-width:820px){
    .type-area{flex-direction:column}
    .right-panel{width:100%}
  }

  /* visually hidden */
  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
</style>
</head>
<body>
  <div class="card" role="application" aria-label="Typing speed test">
    <header>
      <div>
        <h1>Typing Speed Test</h1>
        <p>Type the highlighted text and measure your speed (WPM) and accuracy.</p>
      </div>
      <div class="controls" aria-hidden="false">
        <label for="time">Duration</label>
        <select id="time" title="Test duration in seconds">
          <option value="15">15s</option>
          <option value="30" selected>30s</option>
          <option value="60">60s</option>
          <option value="120">120s</option>
        </select>

        <label for="sample">Sample</label>
        <select id="sample" title="Choose sample paragraph">
          <option value="0">Short: The curious cat...</option>
          <option value="1">Medium: Technology has...</option>
          <option value="2">Long: In the age of...</option>
        </select>

        <button id="start">Start Test</button>
        <button id="reset" class="ghost" disabled>Reset</button>
      </div>
    </header>

    <div class="meta" role="status" aria-live="polite">
      <div class="stat"><div class="num" id="wpm">0</div><div class="lbl">WPM</div></div>
      <div class="stat"><div class="num" id="accuracy">100%</div><div class="lbl">Accuracy</div></div>
      <div class="stat"><div class="num" id="typed">0</div><div class="lbl">Typed</div></div>
      <div class="stat"><div class="num" id="errors">0</div><div class="lbl">Errors</div></div>
    </div>

    <div class="paragraph" id="paragraph" aria-hidden="false"></div>

    <div class="type-area">
      <textarea id="input" placeholder="Click Start, then type here..." aria-label="Typing input" disabled></textarea>
      <div class="right-panel">
        <div class="timer" id="timer">0s</div>
        <div class="progress" aria-hidden="true"><i id="prog"></i></div>
        <div style="height:12px"></div>
        <div class="small">Live preview:</div>
        <div id="live" class="small" style="min-height:48px"></div>
      </div>
    </div>

    <div class="footer">
      <div class="small">Tip: Pasting is disabled. Use Backspace to correct errors.</div>
      <div>
        <button id="finish" class="ghost" disabled>Finish Early</button>
      </div>
    </div>
  </div>

<script>
(function(){
  'use strict';

  const SAMPLES = [
    "The curious cat quietly watched the dancing leaves outside the window.",
    "Technology has reshaped how people communicate, learn, and create â€” opening new possibilities every day.",
    "In the age of rapid innovation, developers and designers work together to craft experiences that are not only powerful but also accessible, engaging, and delightful for users around the world."
  ];

  // Elements
  const paragraphEl = document.getElementById('paragraph');
  const inputEl = document.getElementById('input');
  const startBtn = document.getElementById('start');
  const resetBtn = document.getElementById('reset');
  const finishBtn = document.getElementById('finish');
  const timeSel = document.getElementById('time');
  const sampleSel = document.getElementById('sample');
  const timerEl = document.getElementById('timer');
  const progEl = document.getElementById('prog');
  const liveEl = document.getElementById('live');

  const wpmEl = document.getElementById('wpm');
  const accEl = document.getElementById('accuracy');
  const typedEl = document.getElementById('typed');
  const errorsEl = document.getElementById('errors');
  const resetState = () => {
    wpmEl.textContent='0'; accEl.textContent='100%'; typedEl.textContent='0'; errorsEl.textContent='0';
    timerEl.textContent='0s'; progEl.style.width='0%'; liveEl.textContent='';
  };

  let duration = parseInt(timeSel.value,10);
  let sampleIndex = parseInt(sampleSel.value,10);
  let chars = []; // array of characters
  let timer = null;
  let timeLeft = duration;
  let started = false;
  let totalTyped = 0;
  let mistakes = 0;
  let correctCount = 0;

  function renderSample(index){
    const text = SAMPLES[index];
    chars = text.split('');
    paragraphEl.innerHTML = '';
    chars.forEach((ch, i)=>{
      const span = document.createElement('span');
      span.className = 'char';
      span.textContent = ch;
      span.setAttribute('data-index', i);
      paragraphEl.appendChild(span);
    });
    // mark first character as current
    setCurrentChar(0);
  }

  function setCurrentChar(i){
    const spans = paragraphEl.querySelectorAll('.char');
    spans.forEach(s => s.classList.remove('current'));
    if(spans[i]) spans[i].classList.add('current');
  }

  function startTest(){
    if(started) return;
    duration = parseInt(timeSel.value,10);
    sampleIndex = parseInt(sampleSel.value,10);
    timeLeft = duration;
    totalTyped = 0; mistakes = 0; correctCount = 0;
    started = true;
    inputEl.value='';
    inputEl.disabled=false;
    inputEl.focus();
    startBtn.disabled = true;
    resetBtn.disabled = true;
    finishBtn.disabled = false;
    sampleSel.disabled = true;
    timeSel.disabled = true;
    renderSample(sampleIndex);
    updateStats();
    timerEl.textContent = timeLeft + 's';
    progEl.style.width = '0%';
    timer = setInterval(tick, 1000);
    // prevent paste
    inputEl.addEventListener('paste', onPastePrevent);
  }

  function tick(){
    timeLeft--;
    timerEl.textContent = timeLeft + 's';
    const elapsed = duration - timeLeft;
    const percent = Math.min(100, Math.round((elapsed / duration) * 100));
    progEl.style.width = percent + '%';
    if(timeLeft <= 0){
      finishTest();
    }
  }

  function finishTest(){
    if(!started) return;
    clearInterval(timer);
    started = false;
    inputEl.disabled = true;
    startBtn.disabled = false;
    resetBtn.disabled = false;
    finishBtn.disabled = true;
    sampleSel.disabled = false;
    timeSel.disabled = false;
    inputEl.removeEventListener('paste', onPastePrevent);
    // final compute
    updateStats(true);
  }

  function resetTest(){
    clearInterval(timer);
    started = false;
    inputEl.disabled = true;
    inputEl.value='';
    startBtn.disabled = false;
    resetBtn.disabled = true;
    finishBtn.disabled = true;
    sampleSel.disabled = false;
    timeSel.disabled = false;
    renderSample(parseInt(sampleSel.value,10));
    resetState();
  }

  function onPastePrevent(e){
    e.preventDefault();
    return false;
  }

  function updateStats(final=false){
    const typed = inputEl.value || '';
    totalTyped = typed.length;
    // compute correct characters up to typed length
    correctCount = 0; mistakes = 0;
    const spans = paragraphEl.querySelectorAll('.char');
    for(let i=0;i<spans.length;i++){
      const expected = spans[i].textContent;
      const actual = typed[i] || '';
      spans[i].classList.remove('correct','wrong');
      if(i < typed.length){
        if(actual === expected){
          spans[i].classList.add('correct');
          correctCount++;
        } else {
          spans[i].classList.add('wrong');
          mistakes++;
        }
      }
    }
    // mark next current char
    setCurrentChar(typed.length);

    // WPM calculation: correct characters / 5 per word, divided by minutes elapsed
    const elapsedSecs = final ? (duration - (timeLeft>0?timeLeft:0)) : ( (duration - timeLeft) || 1 );
    const minutes = Math.max(elapsedSecs/60, 1/60); // avoid zero
    const wpm = Math.round( (correctCount/5) / minutes );
    const accuracy = totalTyped > 0 ? Math.round((correctCount / totalTyped) * 100) : 100;

    wpmEl.textContent = isFinite(wpm) ? wpm : 0;
    accEl.textContent = accuracy + '%';
    typedEl.textContent = totalTyped;
    errorsEl.textContent = mistakes;

    // live preview - show last 40 chars typed
    liveEl.textContent = typed.slice(-40);
  }

  // Event listeners
  startBtn.addEventListener('click', startTest);
  finishBtn.addEventListener('click', finishTest);
  resetBtn.addEventListener('click', resetTest);
  timeSel.addEventListener('change', ()=>{
    duration = parseInt(timeSel.value,10);
    timerEl.textContent = duration + 's';
  });
  sampleSel.addEventListener('change', ()=>{
    renderSample(parseInt(sampleSel.value,10));
  });

  inputEl.addEventListener('input', ()=>{
    if(!started) {
      // if user types before clicking start, ignore input and empty field
      inputEl.value='';
      return;
    }
    updateStats();
  });

  // disable paste (extra precaution)
  inputEl.addEventListener('paste', onPastePrevent);

  // initialize
  renderSample(sampleIndex);
  resetState();
  timerEl.textContent = parseInt(timeSel.value,10) + 's';

})();</script>
</body>
</html>
